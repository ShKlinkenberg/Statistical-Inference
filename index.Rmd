---
title: "A Gentle but Critical Introduction to Statistical Inference, Moderation, and Mediation"
author: "Wouter de Nooy "
date: "2016-09-20 - `r Sys.Date()`"
site: bookdown::bookdown_site
output: 
  bookdown::gitbook:
    number_sections : TRUE
    split_by : "section+number"
    split_bib: FALSE
    config:
      toc:
        collapse: section
      sharing: no
    includes:
      in_header: hypothesis.html
  bookdown::pdf_book:
    keep_tex: yes
    toc : TRUE
    toc_depth : 3
    toc_unnumbered : yes
    number_sections : TRUE
    includes: 
      before_body: lists.tex
documentclass: book
geometry: rmargin = 2in
bibliography: ["RefList.bib"]
biblio-style: "apa"
csl: apa.csl
link-citations: true
---

```{r setup, include=FALSE, echo=FALSE}
# All code chunks that should never be shown must have the echo=FALSE option. Chunks with answers to exercises do not have the echo option set, so their visibility is determined by the echo option set for all chunks here. Set echo=FALSE at the start of the course and set it to TRUE after the last tutorial and before the exam.
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, eval=TRUE, tidy=TRUE)
# Libraries used.
library(dplyr)
library(ggplot2)
library(knitr)
library(visNetwork)
library(bookdown)
library(haven)
library(stringr)
# Basic colors and layout.
source("../apps/plottheme/styling.R")
```

```{r include=FALSE, echo=FALSE, eval=FALSE}
# Notes

# PDF output:
#* Embedded shiny apps: Lots of whitespace within the screenshot. Helps to define out.height in chunk - no. cliprect = 'viewport' does not work. selector = "#sampling-distribution-summary1" does not work. vwidth=420, vheight=620 does not work. Setting dev="png" works even though some whitespace remains under the app. Specify out.width (to get a caption) but don't specify out.height (increases the app size).
#* Interactive network visualizations (flow chart in 4.2 Formulating Statistical Hypotheses, mediation models in 9.6 Path Model with Regression Analysis) badly captured (due to fig.asp="50%"?) with lots of whitespace (and of course no link to interactive version). Adding out.width and/or out.height seems to create new problems (mean-centering of consecutive text, caption rendered as LaTex...). Manual screenshots shown with screenshot.alt = "".
#* No screen shots for videos embedded with iframe (4.2.9 Comparing Means in SPSS). Also, a separate figure caption is not numbered. Solved by embedding them with knitr::include_url and dev = "png" but this puts videos in a floating context, so they are no longer in the Instructions section in the PDF. Manually adjust .tex file: replace \begin{figure} by \begin{figure}[H]. Also apply to tables to stop them from floating. Manual screenshots of videos (with correct file names) in figures\videoshots. Copy all to _book\GentleIntro_files\figure-latex and recompile .tex file. Note: Also copy all files in figure-latex directory from _bookdown_files\GentleIntro_files  to the _book\GentleIntro_files.
#* Including a manual screen shot with screenshot.alt = "" solves the white-space problem but it does not add a link to the interactive content (shiny app). Only applicable to dynamic networks that have no link anyhow.

#* Only caption to figure if out.width is set.
#* kable tables are not adjusted to the page margins (see 2.5.2 Conditions for the use of theoretical probability distributions, 9.6.3 Partial and full mediation). out.width="100%" does not help.

#* Equations: use aligned instead of align. But aligned does not work in HTML - need different package to render equations in HTML? 
#* Equations are numbered with the section number. The number is not displayed with the equation itself.

#* HTML table to arrange text and pictures does not work: 2.1 (baron), 3.5.1 (Neyman), 5.2 (metal detector), 5.3.1 (Pearson), 6.3.2 (Gauss, LaPlace). Size of picture must be made explicit. Embed with knitr::include_graphics and set output.width? Note that include_graphics makes the picture float, which is not what I want with portraits. Also, the dpi seems to matter to eventual out.width of r chunck wth include_graphics.

# Links to external resources such as (SPSS) data must be absolute. They cannot be stored in the R Markdown doc root directory, so I store them in a data subdirectory of the shiny server http://82.196.4.233:3838/data. Embed links as HTML with target="_blank" to open the resource in a new window otherwise the Shiny server displays the R Markdown document in grey (must be reloaded).

# Include SPSS tabular output:
#- Right-click table, select Style Output, Select as Group (Continue), Table Look, Compact.
#- Select tales to be exported. Don't select separate analysis titles, they are badly formatted.
#- Right-click selected table and export as HTML, Change Options: Export visible layer only, Export without styling, Include footnotes and captions, Export visible view only.
#- Export HTML file to R project directory.
#- Include HTML file in R Markdown within <iframe>. Set width="100%" and experiment to find the right height.
# Note that html content embedded in this way yields problems with webshot capturing if the document is knitted into PDF. 
```

```{r example-data, include=FALSE, echo=FALSE, eval=FALSE}
source("norm10.R") #function to normalize scores to [1-10] or [0-10]
# SPSS data set candy colour (uniform) and weight (normal, M = 2.8, SD = 0.2), N= 50.
set.seed(seed = 12345)

# Candy bags example.
candies <- data.frame(colour = factor(c("blue","green","yellow","orange","red")), weight = rnorm(50, mean = 2.8, sd = 0.2), sticky = factor(c(rep(c("sticky", "sticky", "not sticky", "sticky", "not sticky"), 6), rep(c("sticky", "not sticky"), 9), c("not sticky", "sticky"))), colour_pre = rnorm(50, mean = 7.3, sd = 0.5))
set.seed(seed = 8734)
candies$colour_post <- candies$colour_pre + ifelse(candies$colour %in% c("blue","green","orange"), rnorm(50, mean = -1.1, sd = 0.1), ifelse(candies$colour == "yellow", rnorm(50, mean = -2.4, sd = 0.2), rnorm(50, mean = -3.7, sd = 0.4)))
set.seed(seed = 3295)
candies$sweetness <- 12 - candies$colour_post + rnorm(50, mean = 0, sd = 1.7)
candies$sweetness <- norm10(candies$sweetness) #normalize to 1-10
set.seed(seed = 9501)
candies$help <- runif(50, 0, 1)
candies$spotted <- factor(ifelse((candies$colour %in% c("blue", "green", "red") & candies$help > 0.3) | (candies$colour %in% c("yellow", "orange") & candies$help > 0.7), "spotted", "not-spotted")) 
candies$help <- NULL
attributes(candies$colour)$label <- "Candy colour"
attributes(candies$weight)$label <- "Candy weight (grams)"
attributes(candies$sticky)$label <- "Candy is sticky"
attributes(candies$colour_pre)$label <- "Candy colourfulness before exposure to sun light"
attributes(candies$spotted)$label <- "Candy is spotted"
candies$colour_pre <- labelled::labelled(candies$colour_pre, labels = c(`Totally faded` = 1, `Maximum colourfulness` = 10)) #Set value labels for export to SPSS
attributes(candies$colour_post)$label <- "Candy colourfulness after exposure to sun light"
candies$colour_post <- labelled::labelled(candies$colour_post, labels = c(`Totally faded` = 1, `Maximum colourfulness` = 10))
attributes(candies$sweetness)$label <- "Candy sweetness"
candies$sweetness <- labelled::labelled(candies$sweetness, labels = c(`Not a bit sweet` = 1, `Super sweet` = 10))
haven::write_sav(candies, "data/candies.sav")

# Households: tv station reach, region, household income.
set.seed(2583)
random <- runif(120)
households <- data.frame(region = ifelse(random <= 0.2, "North", ifelse(random <= 0.45, "East", ifelse(random <= 0.75, "South", "West"))))
set.seed(6111)
random <- runif(120)
households$tv_reach <- "no"
households$tv_reach[(households$region == "North" & random < 0.2) | (households$region == "East" & random < 0.7) | (households$region == "South" & random < 0.4) | (households$region == "West" & random < 0.9)] <- "yes"
households$tv_reach <- factor(households$tv_reach)
households$income <- rnorm(120, mean = 40000, sd = 12000) + ifelse(households$region == "West" | households$region == "East", runif(120) * 10000, 0)
attributes(households$region)$label <- "Region of residence"
attributes(households$tv_reach)$label <- "Can the household receive the tv station?"
attributes(households$income)$label <- "Household income"
haven::write_sav(households, "data/households.sav")

# Children: media literacy, sex, age, supervision.
set.seed(2583)
children <- data.frame(medliter = rnorm(87, mean = 4.3, sd = 1.8), sex = c(rep("girl", 46), rep("boy", 40), "")) #One impossible value.
children$medliter <- children$medliter - min(children$medliter) + 1
set.seed(1174)
children$age <- round((children$medliter + 22 + rnorm(87, mean = 0, sd = 5.1))/3)
set.seed(3228)
children$supervision <- (children$medliter + rnorm(87, mean = 0, sd = 3.6))
children$supervision <- norm10(children$supervision) #normalize to 1-10
children$supervision[30] <- 25 # Impossible value.
# Set labels.
attributes(children$sex)$label <- "Sex"
attributes(children$age)$label <- "Age (in years)"
attributes(children$medliter)$label <- "Media literacy"
children$medliter <- labelled::labelled(children$medliter, labels = c(`No media literacy at all` = 1, `Maximum media literacy` = 10))
attributes(children$supervision)$label <- "Parental supervision during media use"
children$supervision <- labelled::labelled(children$supervision, labels = c(`Never supervised` = 1, `Supervised all the time` = 10))
haven::write_sav(children, "data/children.sav")

# Voters: immigrant opinion, age (class: young vs. old).
set.seed(1324)
voters <- data.frame(age = round(runif(66) * 70 + 17))
voters$age_group <- factor(ifelse(voters$age < 30, "young (<30)", "old (30+)"))
set.seed(2431)
voters$immigrant <- ifelse(voters$age_group == "young (<30)", round(rnorm(66, mean = 5, sd = 1.4)), round(rnorm(66, mean = 5.1, sd = 1.8)))
voters$immigrant[voters$immigrant < 1] <- 1
voters$immigrant[voters$immigrant > 10] <- 10
attributes(voters$age)$label <- "Age"
attributes(voters$age_group)$label <- "Age group"
attributes(voters$immigrant)$label <- "Attitude towards immigrants"
voters$immigrant <- labelled::labelled(voters$immigrant, labels = c(`Very hostile towards immigrants` = 1, `Very welcoming to immigrants` = 10))
haven::write_sav(voters, "data/voters.sav")

# Donors: endorser of the campaign, remember campaign, exposure to campaign, willingness to donate to the campaign (pre and post), sex.
# Create predictors.
set.seed(1245)
remember <- sample(c(0,1), size = 143, replace = TRUE, prob = c(0.5, 0.5))
set.seed(320)
exposure <- norm10(rnorm(143, 0, 1))
sex <- c(rep(0, 71), rep(1, 72))
endorser <- c(rep(0,22), rep(1,24), rep(2, 25), rep(0,23), rep(1,25), rep(2, 24))
# Create outcome.
Clooney <- ifelse(endorser==1, 1, 0)
Jolie <- ifelse(endorser==2, 1, 0)
set.seed(1245)
willing_post <- 3 + 0.84*remember + 0.51*sex + 0.1*exposure + 0.03*Clooney + 1.13*Jolie + 1.23*Clooney*sex - 0.77*Jolie*sex + rnorm(143, 0, 1.48)
# Create pre-measurement of outcome.
set.seed(4944)
willing_pre <- willing_post + runif(143, -0.6, 0.3)
# Join in dataframe.
donors <- data.frame(willing_post, willing_pre, exposure, remember, endorser, sex)
# Cleanup.
rm(Clooney, Jolie, willing_post, willing_pre, exposure, remember, endorser, sex)
# Add labels.
attributes(donors$willing_post)$label <- "Respondent's willingness to donate at the campaign end"
donors$willing_post <- labelled::labelled(donors$willing_post, labels = c(`I am very sure not to donate` = 1, `I am very sure to donate` = 10))
attributes(donors$willing_pre)$label <- "Respondent's willingness to donate at the campaign start"
donors$willing_pre <- labelled::labelled(donors$willing_pre, labels = c(`I am very sure not to donate` = 1, `I am very sure to donate` = 10))
attributes(donors$exposure)$label <- "Respondent's exposure to the campaign"
donors$exposure <- labelled::labelled(donors$exposure, labels = c(`No exposure` = 1, `Maximum exposure` = 10))
attributes(donors$remember)$label <- "Respondent remembers the campaign?"
donors$remember <- labelled::labelled(donors$remember, labels = c(`Does not recognize the campaign` = 0, `Recognizes the campaign` = 1))
attributes(donors$endorser)$label <- "Celebrity endorsing the campaign"
donors$endorser <- labelled::labelled(donors$endorser, labels = c(`Nobody` = 0, `George Clooney` = 1, `Angelina Jolie` = 2))
attributes(donors$sex)$label <- "Respondent's sex"
donors$sex <- labelled::labelled(donors$sex, labels = c(`Male` = 0, `Female` = 1))
haven::write_sav(donors, "data/donors.sav")
# Note: Set factors to nominal scale in SPSS.

#Consumers: brand awareness, ad exposure, word of mouth, gender.
set.seed(834)
consumers <- data.frame(ad_expo = norm10(sqrt(rnorm(62, 10, 4.8))), wom = c(rep("yes", 18), rep("no", 44)), gender = c(rep("female", 12), rep("male", 6), rep("female", 19), rep("male", 25)))
set.seed(825)
consumers$brand_aw <- norm10(consumers$ad_expo - as.integer(consumers$gender) * 1.2 - as.integer(consumers$wom) * 1.7 + rnorm(62, 0, 3.3))
attributes(consumers$ad_expo)$label <- "Exposure to brand advertisements"
attributes(consumers$wom)$label <- "Heard about the brand by word of mouth?"
attributes(consumers$gender)$label <- "Consumer's sex"
attributes(consumers$brand_aw)$label <- "Brand awareness"
consumers$ad_expo <- labelled::labelled(consumers$ad_expo, labels = c(`No exposure to ads` = 1, `Maximum exposure to ads` = 10))
consumers$brand_aw <- labelled::labelled(consumers$brand_aw, labels = c(`Does not recognize the brand at all` = 1, `Knows the brand very well` = 10))
haven::write_sav(consumers, "data/consumers.sav")

#Smokers: attitude [-5, 5], exposure [0, 10], (smoking) status [2 or 3 cat.], contact (with smokers) [0, 10].
set.seed(4932)
smokers <- data.frame(exposure = runif(85)*10, status2 = rbinom(85, 1, 0.2))
smokers$status3[smokers$status2 == 1] <- 2
set.seed(8220)
smokers$status3[smokers$status2 != 1] <- rbinom(sum(smokers$status2 != 1), 1, 0.3)
set.seed(4321)
smokers$contact <- 0.26*(10 - smokers$exposure) + rnorm(85, mean = 0, sd = 2)
smokers$contact <- norm10(smokers$contact, lbound1 = FALSE)
set.seed(390)
smokers$attitude <- 1.5*(-0.26*smokers$exposure + 
  0.03*smokers$exposure*smokers$contact +
  -0.8*(smokers$status3 == 1) +
  -0.24*smokers$exposure*(smokers$status3 == 1) +
  0.7*(smokers$status3 == 2) +
  -0.20*smokers$exposure*(smokers$status3 == 2) +
  rnorm(85, mean = 1, sd = 0.6))
attributes(smokers$exposure)$label <- "Exposure to anti-smoking campaign"
smokers$exposure <- labelled::labelled(smokers$exposure, labels = c(`No exposure` = 0, `Maximum exposure` = 10))
attributes(smokers$contact)$label <- "Contact with smokers"
smokers$contact <- labelled::labelled(smokers$contact, labels = c(`No contact` = 0, `Maximum contact` = 10))
attributes(smokers$attitude)$label <- "Attitude towards smoking"
smokers$attitude <- labelled::labelled(smokers$attitude, labels = c(`Very negative` = -5, `Neutral`= 0, `Very positive` = 5))
attributes(smokers$status2)$label <- "Smoking status"
smokers$status2 <- labelled::labelled(smokers$status2, labels = c(`Non-smoker` = 0, `Smoker` = 1))
attributes(smokers$status3)$label <- "Smoking status"
smokers$status3 <- labelled::labelled(smokers$status3, labels = c(`Non-smoker` = 0, `Former smoker` = 1, `Smoker` = 2))
haven::write_sav(smokers, "data/smokers.sav")

# Readers: Predicting newspaper reading time from news site use, political scepticism, political interest, education level, and age.
# Age (in decades).
set.seed(5554)
readers <- data.frame(age = round(runif(n = 312, min = 1.8, max = 8.2), digits = 1))
attributes(readers$age)$label <- "Age (in decades)"
# Education level (in years).
set.seed(4466)
readers$education <- round(-readers$age + rnorm(n = 312, mean = 0, sd = 15), digits = 0)
readers$education <- 8 + round(norm10(readers$education, lbound1 = FALSE), digits = 0)
attributes(readers$education)$label <- "Education level (in years)"
# Political interest (10-point scale).
set.seed(7373)
readers$polinterest <- round(norm10(0.3*readers$age + 1.2*readers$education + rnorm(n = 312, mean = 0, sd = 6)), digits = 1)
attributes(readers$polinterest)$label <- "Interest in politics (scale)"
# Political cynicism (10-point scale).
set.seed(3737)
readers$polcynic <- round(norm10(-0.8*readers$age - 1.4*readers$education + rnorm(n = 312, mean = 0, sd = 6)), digits = 1)
attributes(readers$polcynic)$label <- "Political cynicism (scale)"
# News site use (7-point scale).
set.seed(2176)
readers$newssite <- round(norm10(-8.6*readers$age + 1.4*readers$polinterest + rnorm(n = 312, mean = 0, sd = 6)), digits = 0)
readers$newssite[readers$newssite == 1] <- 2
readers$newssite[readers$newssite > 8] <- 8
readers$newssite <- readers$newssite - 2
attributes(readers$newssite)$label <- "News sites use"
# Newspaper reading time (minutes per day on average).
set.seed(3310)
readers$readingtime <- round(4.6*readers$age + 0.3*readers$education + 0.5*readers$polinterest - 0.1*readers$polcynic - 1.3*readers$newssite + rnorm(n = 312, mean = 0, sd = 6), digits = 0) 
readers$readingtime <- readers$readingtime - min(readers$readingtime)
attributes(readers$readingtime)$label <- "Average newspaper reading time per day (minutes)"
# Add value labels and export to SPSS data file.
readers$newssite <- labelled::labelled(readers$newssite, labels = c(`Never` = 0, `At most once a week` = 1, `Twice a week` = 2, `Once a day` = 3, `Twice a day` = 4, `Three times a day` = 5, `At least four times a day` = 6))
haven::write_sav(readers, "data/readers.sav")
```

# Introduction and Reader's Guide {-}

In the years that I have been teaching inferential statistics to bachelor students in Communication Science, I have learned two things. First, it is paramount that students thoroughly understand the principles of statistical inference before they can apply statistical inference correctly themselves. Second, formal notation, manual calculation, and estimation details distract rather than help students understand what they are doing. This book offers a non-technical but thorough introduction to statistical inference. It discusses a minimal set of concepts needed to understand both the possibilities and pitfalls of estimation, null hypothesis testing, moderation, and mediation analysis. It uses a minimum of formal notation.

### Intended Audience and Setting {-}

This book is written as reading material for a follow-up course in statistics, in the bachelor of Communication Science at the University of Amsterdam. Students enrolled in this course, have had an introductory course in statistics that explained how to change research questions into variables and associations between variables, how to select and execute the correct analysis or test (in SPSS) to answer their research question, and how to interpret the results in a language that is both comprehensible for the average reader and complying with professional standards (APA6 standard for reporting test results). In addition, they have learned the very basics of inferential statistics: How to decide which null hypothesis to reject based on reported p values, and how to interpret confidence intervals.  

This book is meant for use in a flipped-classroom setting. Students should read the text, watch embedded videos, and play with the interactive content before they meet in class. Class meetings are used to answer questions raised by the students, do group work to exercise with the concepts and techniques presented in the text, and do little tests to check understanding.  

### Interactive Content {-}

The interactive content in this book replaces simulations that used to be demonstrated during lectures. I expect that doing simulations yourself rather than watching them being done by someone else enhances understanding. I have tried to break down the simulations into smaller steps, confronting the student several times with essentially the same simulation, but with added complexity. I hope that this approach enhances understanding and remembrance and, at the same time, avoids frustration caused by complex dashboards offering all options at once. 

Most interactive content starts with a question regarding the student's expectations of what is going to happen in the simulation. I strongly recommend that students state their expectations before they start the simulations to see where their intuitions are right and where they are wrong. 

With a similar objective, each chapter starts with a _Test your intuition and understanding_ Section: interactive content with questions. On first reading, play with the content and use your intuition to answer the questions. Don't worry if you do not know all the answers; the subject matter is explained step by step in the remainder of the chapter. On re-reading and exam preparation, use this section to test your understanding. If you understand the interactive content and know the answers to the questions, you understand the core concepts of the chapter.

### Disclaimer {-}

The example data sets have been generated for the purpose of demonstrating statistical techniques. These are not real data and no conclusions should be drawn from the results obtained from the data.

### Acknowledgements {-}

Adam Sasiadek developed the more complicated Shiny apps in this book. The College of Communication at the University of Amsterdam generously supported the creation of the apps whereas this university's Grassroots Project for ICT in education refused to support it. Renske van Bronswijk corrected my English. Any remaining errors result from changes and additions that I applied afterwards. My colleague Peter Neijens commented on a draft of this text.
